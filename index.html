<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Private Price Code Image</title>

    <style>
      * {
        box-sizing: border-box;
        font-family: "Segoe UI", sans-serif;
      }

      body {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .card {
        background: rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(15px);
        padding: 25px;
        width: 420px;
        border-radius: 16px;
        color: white;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
      }

      h2 {
        text-align: center;
        margin-bottom: 20px;
      }

      input,
      button {
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        border-radius: 10px;
        border: none;
        outline: none;
      }

      input {
        background: rgba(255, 255, 255, 0.2);
        color: white;
      }

      input::placeholder {
        color: #ddd;
      }

      button {
        background: linear-gradient(135deg, #00c6ff, #0072ff);
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
      }

      button:hover {
        transform: scale(1.03);
      }

      canvas {
        width: 100%;
        margin-top: 15px;
        border-radius: 12px;
      }
    </style>
  </head>

  <body>
    <div class="card">
      <h2>Private Price Image Generator</h2>

      <input type="file" id="imageInput" accept="image/*" />
      <input type="number" id="rmbPrice" placeholder="Real price (RMB)" />

      <button onclick="generate()">Generate Secure Image</button>
      <button onclick="download()">Download Image</button>

      <canvas id="canvas"></canvas>
    </div>

   <script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const img = new Image();

  document.getElementById("imageInput").addEventListener("change", e => {
    const reader = new FileReader();
    reader.onload = () => img.src = reader.result;
    reader.readAsDataURL(e.target.files[0]);
  });

  // üîê Generate secure code (digits stay in correct order)
  function generateUniqueCode(price) {
    const letters = "abcdefghijklmnopqrstuvwxyz";
    const digits = price.toString();

    // Generate 4 random letters
    let randomLetters = [];
    for (let i = 0; i < 4; i++) {
      randomLetters.push(
        letters[Math.floor(Math.random() * letters.length)]
      );
    }

    let result = "";
    let letterIndex = 0;

    // Random letters before first digit
    const beforeCount = Math.floor(Math.random() * 3);
    for (let i = 0; i < beforeCount; i++) {
      result += randomLetters[letterIndex++];
    }

    // Insert digits in order with random letters between
    for (let i = 0; i < digits.length; i++) {
      result += digits[i];

      const betweenCount = Math.floor(Math.random() * 2);
      for (let j = 0; j < betweenCount && letterIndex < randomLetters.length; j++) {
        result += randomLetters[letterIndex++];
      }
    }

    // Remaining letters at end
    while (letterIndex < randomLetters.length) {
      result += randomLetters[letterIndex++];
    }

    return result;
  }

  function generate() {
    const rmb = document.getElementById("rmbPrice").value;

    if (!img.src || !rmb) {
      alert("Upload image and enter RMB price");
      return;
    }

    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0);

      const code = generateUniqueCode(rmb);

      const fontSize = Math.max(20, canvas.width * 0.035);
      ctx.font = `bold ${fontSize}px Arial`;

      const textWidth = ctx.measureText(code).width;

      const paddingX = 18;
      const paddingY = 10;

      const boxWidth = textWidth + paddingX * 2;
      const boxHeight = fontSize + paddingY * 2;

      const margin = 20;
      const x = canvas.width - boxWidth - margin;
      const y = canvas.height - boxHeight - margin;

      ctx.fillStyle = "rgba(0, 0, 0, 0.65)";
      ctx.beginPath();
      ctx.roundRect(x, y, boxWidth, boxHeight, 10);
      ctx.fill();

      ctx.fillStyle = "#ffffff";
      ctx.textAlign = "left";
      ctx.textBaseline = "middle";
      ctx.fillText(
        code,
        x + paddingX,
        y + boxHeight / 2
      );
    };

    if (img.complete) img.onload();
  }

  function download() {
    const a = document.createElement("a");
    a.href = canvas.toDataURL("image/png");
    a.download = "secured-product.png";
    a.click();
  }
</script>

  </body>
</html>
